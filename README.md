## Torrent 사용을 위한 EC2 system

<img src="https://this.ismin.uk/resources/aws-torrent.svg" title="AWS-torrent의 aws구조. EC2인스턴스 한개, S3한개로 간단한 구성이지만 Dynamic Allocated EBS들이 있어, 토렌트 사이즈에 따라 동적으로 EBS를 할당해 다운받는다." alt="AWS-torrent의 aws구조. EC2인스턴스 한개, S3한개로 간단한 구성이지만 Dynamic Allocated EBS들이 있어, 토렌트 사이즈에 따라 동적으로 EBS를 할당해 다운받는다.">
이 프로젝트는 특별히 이름은 없는데, 대략적으로 AWS-torrent정도로 부르고 있다. 기본적으로는 ec2에서 토렌트를 다운받는 프로젝트인데, Dynamic EBS Allocation이라 부르는 기능을 추가해놨다.

원래는 100GB를 할당해 매번 다운받고, S3업로드 하고, 다시 지우고하는걸 구성해놨는데 이게 100GB도 나름 아까워서 30GB로 줄였다. 대신 토렌트를 다운받기 시작해 토렌트의 정보가 완성되는 순간(토렌트는 다운받는 순간 완료될 파일의 사이즈, 갯수등을 바로 알 수 없다.) 새롭게 EBS를 할당받는다. 이 EBS는 토렌트의 사이즈보다 약간 더 큰 용량으로 할당받아 ec2에 마운트 해준다. 마운트가 끝나면 토렌트를 이쪽으로 이동시켜준뒤 기존의 파일은 삭제한다. 다운로드가 완료되면 S3에 업로드하고 토렌트 파일을 지운다.

무분별한 할당을 막기위해 남는공간이 있다면 기존에 사용하는 EBS볼륨으로 저장위치를 정하게 되는데 오래 사용하다보면 EBS에 파편화가 생긴다. 이를 막기위해 다운로드가 끝날때마다 각 토렌트의 사이즈, EBS볼륨의 공간을 계산해 조각모음 하듯이 한쪽으로 몰아놓고 빈 EBS들은 풀어준다.

결국 이것마저도 비싸다고 느껴, 라즈베리 파이에 토렌트 서버를 구축하니 이젠 안쓰이는 프로젝트가 되어버렸다. ㅠㅠ
이제는 EFS가 나와버려서 특별히 이렇게 할 필요는 없지만, 동적할당이라는 주제로 뭔가를 해보기에는 나름 괜찮은 경험이었다.
